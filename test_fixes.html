<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            direction: rtl;
            text-align: right;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .btn-test { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>ุงุฎุชุจุงุฑ ุฅุตูุงุญุงุช ูุธุงู ุงูุงุณุชูุทุงุนุงุช</h1>
    
    <div class="test-section">
        <h3>1. ุงุฎุชุจุงุฑ ุชุฑููุจ ุงูููุฏ (Syntax)</h3>
        <p>ูุญุต ุตุญุฉ ุงูุชุฑููุจ ุงููุญูู ููููุฏ...</p>
        <div id="syntax-result"></div>
        <button class="btn-test" onclick="testSyntax()">ุงุฎุชุจุงุฑ ุงูุชุฑููุจ</button>
    </div>

    <div class="test-section">
        <h3>2. ุงุฎุชุจุงุฑ ุฏูุงู ุงูุงุณุชูุทุงุน</h3>
        <p>ูุญุต ุฏูุงู ุฅุถุงูุฉ ูุชุนุฏูู ูุญุฐู ุงูุงุณุชูุทุงุนุงุช...</p>
        <div id="functions-result"></div>
        <button class="btn-test" onclick="testDeductionFunctions()">ุงุฎุชุจุงุฑ ุงูุฏูุงู</button>
    </div>

    <div class="test-section">
        <h3>3. ุงุฎุชุจุงุฑ ุงููุฒุงููุฉ</h3>
        <p>ูุญุต ุขููุฉ ุงููุฒุงููุฉ ูุน Firebase...</p>
        <div id="sync-result"></div>
        <button class="btn-test" onclick="testFirebaseSync()">ุงุฎุชุจุงุฑ ุงููุฒุงููุฉ</button>
    </div>

    <div class="test-section">
        <h3>4. ุงุฎุชุจุงุฑ ุดุงูู</h3>
        <p>ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช...</p>
        <div id="comprehensive-result"></div>
        <button class="btn-success" onclick="runAllTests()">ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช</button>
    </div>

    <script>
        function testSyntax() {
            const result = document.getElementById('syntax-result');
            result.innerHTML = '<p>๐ ุฌุงุฑู ูุญุต ุงูุชุฑููุจ ุงููุญูู...</p>';
            
            try {
                // ุงุฎุชุจุงุฑ ุชุฑููุจ JavaScript
                eval(`
                    const testObj = { ...{a: 1}, ...{b: 2} };
                    const testArr = [...[1, 2, 3]];
                `);
                
                result.innerHTML = '<p class="success">โ ุงูุชุฑููุจ ุงููุญูู ุตุญูุญ</p>';
                result.className = 'success';
            } catch (error) {
                result.innerHTML = `<p class="error">โ ุฎุทุฃ ูู ุงูุชุฑููุจ: ${error.message}</p>`;
                result.className = 'error';
            }
        }

        function testDeductionFunctions() {
            const result = document.getElementById('functions-result');
            result.innerHTML = '<p>๐ ุฌุงุฑู ูุญุต ุฏูุงู ุงูุงุณุชูุทุงุน...</p>';
            
            try {
                // ูุญุงูุงุฉ DataManager
                const mockDataManager = {
                    deductionsData: [
                        { id: 1, amount: 1000, caseNumber: 'C001' },
                        { id: 2, amount: 2000, caseNumber: 'C002' }
                    ],
                    
                    updateDeduction(id, updates) {
                        const index = this.deductionsData.findIndex(d => d.id === id);
                        if (index !== -1) {
                            this.deductionsData[index] = { ...this.deductionsData[index], ...updates };
                            return this.deductionsData[index];
                        }
                        return null;
                    },
                    
                    deleteDeduction(id) {
                        const initialLength = this.deductionsData.length;
                        this.deductionsData = this.deductionsData.filter(d => d.id !== id);
                        return this.deductionsData.length < initialLength;
                    }
                };
                
                // ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ
                const updated = mockDataManager.updateDeduction(1, { amount: 1500 });
                if (!updated || updated.amount !== 1500) {
                    throw new Error('ูุดู ูู ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ');
                }
                
                // ุงุฎุชุจุงุฑ ุงูุญุฐู
                const deleted = mockDataManager.deleteDeduction(2);
                if (!deleted || mockDataManager.deductionsData.length !== 1) {
                    throw new Error('ูุดู ูู ุงุฎุชุจุงุฑ ุงูุญุฐู');
                }
                
                result.innerHTML = '<p class="success">โ ุฌููุน ุฏูุงู ุงูุงุณุชูุทุงุน ุชุนูู ุจุดูู ุตุญูุญ</p>';
                result.className = 'success';
                
            } catch (error) {
                result.innerHTML = `<p class="error">โ ุฎุทุฃ ูู ุฏูุงู ุงูุงุณุชูุทุงุน: ${error.message}</p>`;
                result.className = 'error';
            }
        }

        function testFirebaseSync() {
            const result = document.getElementById('sync-result');
            result.innerHTML = '<p>๐ ุฌุงุฑู ูุญุต ุขููุฉ ุงููุฒุงููุฉ...</p>';
            
            try {
                // ูุญุงูุงุฉ ุขููุฉ ุงููุฒุงููุฉ ุงูุฌุฏูุฏุฉ
                const mockFirebaseUpdates = {};
                const mockData = [
                    { id: 'deduction_001', amount: 1000 },
                    { id: 'deduction_002', amount: 2000 }
                ];
                
                const path = 'legal_data/deductions/payments';
                
                // ุงุฎุชุจุงุฑ ุงูุขููุฉ ุงูุฌุฏูุฏุฉ (ุนูุตุฑ ุจุนูุตุฑ)
                mockData.forEach((item) => {
                    if (item && typeof item === 'object' && item.id) {
                        mockFirebaseUpdates[`${path}/${item.id}`] = {
                            ...item,
                            lastSync: new Date().toISOString(),
                            syncVersion: '4.0'
                        };
                    }
                });
                
                // ุงูุชุญูู ูู ุงููุชูุฌุฉ
                const expectedKeys = [
                    'legal_data/deductions/payments/deduction_001',
                    'legal_data/deductions/payments/deduction_002'
                ];
                
                const actualKeys = Object.keys(mockFirebaseUpdates);
                const hasCorrectStructure = expectedKeys.every(key => actualKeys.includes(key));
                
                if (!hasCorrectStructure) {
                    throw new Error('ูููู ุงููุฒุงููุฉ ุบูุฑ ุตุญูุญ');
                }
                
                // ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุงูููุชุงุญ ุงููุฏูู ุงูุฐู ูุญุฐู ุงูุจูุงูุงุช
                if (mockFirebaseUpdates[path]) {
                    throw new Error('ูุง ุฒุงู ูุณุชุฎุฏู ุงูููุชุงุญ ุงููุฏูู ุงูุฐู ูุญุฐู ุงูุจูุงูุงุช');
                }
                
                result.innerHTML = '<p class="success">โ ุขููุฉ ุงููุฒุงููุฉ ุชุนูู ุจุดูู ุตุญูุญ (ูุง ุชุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ)</p>';
                result.className = 'success';
                
            } catch (error) {
                result.innerHTML = `<p class="error">โ ุฎุทุฃ ูู ุขููุฉ ุงููุฒุงููุฉ: ${error.message}</p>`;
                result.className = 'error';
            }
        }

        function runAllTests() {
            const result = document.getElementById('comprehensive-result');
            result.innerHTML = '<p>๐ ุฌุงุฑู ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช...</p>';
            
            setTimeout(() => {
                testSyntax();
                setTimeout(() => {
                    testDeductionFunctions();
                    setTimeout(() => {
                        testFirebaseSync();
                        setTimeout(() => {
                            const allSuccess = 
                                document.getElementById('syntax-result').className === 'success' &&
                                document.getElementById('functions-result').className === 'success' &&
                                document.getElementById('sync-result').className === 'success';
                            
                            if (allSuccess) {
                                result.innerHTML = '<p class="success">๐ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช! ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู</p>';
                                result.className = 'success';
                            } else {
                                result.innerHTML = '<p class="error">โ๏ธ ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุดูุช. ุฑุงุฌุน ุงููุชุงุฆุฌ ุฃุนูุงู</p>';
                                result.className = 'error';
                            }
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);
        }

        // ุชุดุบูู ุงุฎุชุจุงุฑ ุณุฑูุน ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        window.addEventListener('load', () => {
            console.log('๐ง ุตูุญุฉ ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช ุฌุงูุฒุฉ');
            console.log('๐ ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:');
            console.log('   1. ุฅุตูุงุญ ุฏูุงู ุงูุงุณุชูุทุงุน (ุงูุชุฑููุจ ุงููุญูู)');
            console.log('   2. ุฅุตูุงุญ ูุฒุงููุฉ Firebase (ููุน ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ)');
            console.log('   3. ุชูุญูุฏ ูููู ุงูุจูุงูุงุช ุจูู ุงูุชุทุจูููู');
        });
    </script>
</body>
</html>